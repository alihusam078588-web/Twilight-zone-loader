name: Twisted of the Day

on:
  schedule:
    - cron: '0 22 * * *' # Runs daily at 22:00 UTC (â‰ˆ 1:00 AM Iraq time)
  workflow_dispatch:

jobs:
  send:
    runs-on: ubuntu-latest

    steps:
      - name: Fetch Twisted from Tumblr and send webhook
        run: |
          python3 << 'EOF'
          import requests
          import re
          from datetime import datetime

          TUMBLR_URL = "https://www.tumblr.com/twisted-of-the-day/tagged/dandy%E2%80%99s%20world"
          WEBHOOK_URL = "https://discord.com/api/webhooks/1449788203082191100/E6NMZ-b7wc-PHLS4lRY0E6ZV4Yas5IXLLHOIP8iN-8fn5L1KNkcBUhWsQytL2T9BVLpK"

          headers = {
              "User-Agent": "Mozilla/5.0"
          }

          response = requests.get(TUMBLR_URL, headers=headers, timeout=15)
          html = response.text

          # Extract "Twisted of the Day: NAME"
          match = re.search(
              r"Twisted of the Day[:\-]\s*([A-Za-z\s]+)",
              html,
              re.IGNORECASE
          )

          twisted = match.group(1).strip() if match else "Unknown Twisted"

          payload = {
              "username": "Dandy's World",
              "embeds": [
                  {
                      "title": "ðŸŒ€ Twisted of the Day",
                      "description": f"**{twisted}**",
                      "color": 10181046,
                      "footer": {
                          "text": "Twisted of the Day"
                      },
                      "timestamp": datetime.utcnow().isoformat()
                  }
              ]
          }

          requests.post(WEBHOOK_URL, json=payload)
          EOF