name: Twisted of the Day

on:
  schedule:
    - cron: '0 22 * * *' # 22:00 UTC â‰ˆ 1:00 AM Iraq time
  workflow_dispatch:

jobs:
  send:
    runs-on: ubuntu-latest

    steps:
      - name: Fetch Twisted from Tumblr RSS and send webhook
        run: |
          python3 << 'EOF'
          import requests
          import xml.etree.ElementTree as ET
          import re
          from datetime import datetime

          RSS_URL = "https://twisted-of-the-day.tumblr.com/rss"
          WEBHOOK_URL = "https://discord.com/api/webhooks/1449788203082191100/E6NMZ-b7wc-PHLS4lRY0E6ZV4Yas5IXLLHOIP8iN-8fn5L1KNkcBUhWsQytL2T9BVLpK"

          rss = requests.get(RSS_URL, timeout=15).text
          root = ET.fromstring(rss)

          # Get latest post title
          title = root.find(".//item/title").text

          # Extract name from "Twisted of the Day: NAME"
          match = re.search(
              r"Twisted of the Day[:\-]\s*(.+)",
              title,
              re.IGNORECASE
          )

          twisted = match.group(1).strip() if match else title.strip()

          payload = {
              "username": "Dandy's World",
              "embeds": [
                  {
                      "title": "ðŸŒ€ Twisted of the Day",
                      "description": f"**{twisted}**",
                      "color": 10181046,
                      "footer": {
                          "text": "Twisted of the Day"
                      },
                      "timestamp": datetime.utcnow().isoformat()
                  }
              ]
          }

          requests.post(WEBHOOK_URL, json=payload)
          EOF