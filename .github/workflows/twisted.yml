name: Twisted of the Day (Auto Wiki)

on:
  schedule:
    - cron: '0 22 * * *' # 01:00 AM Iraq time
  workflow_dispatch:

jobs:
  send:
    runs-on: ubuntu-latest

    steps:
      - name: Fetch Twisted from Wiki and send webhook
        run: |
          python3 << 'EOF'
          import requests
          import re
          from datetime import datetime

          WIKI_URL = "https://dandys-world-robloxhorror.fandom.com/wiki/Daily_Twisted_Board"
          WEBHOOK_URL = "https://discord.com/api/webhooks/1459847207497896058/icUXwM2bg0wYP_BQ7IpD2-zerq19z_rdyL8Zj2K1g6_e_Zv6KOLuxlHVs3vVySs3rPdW"

          # Get wiki page
          response = requests.get(WIKI_URL, timeout=15)
          html = response.text

          # Extract twisted name
          match = re.search(
              r"Currently, the board is occupied by\s*([A-Za-z\s]+)\.",
              html
          )

          twisted = match.group(1).strip() if match else "Unknown Twisted"

          payload = {
              "username": "Dandy's World",
              "embeds": [
                  {
                      "title": "ðŸŒ€ Twisted of the Day",
                      "description": f"**{twisted}**\n\n(Auto-fetched from the Daily Twisted Board)",
                      "color": 10181046,
                      "footer": {
                          "text": "Daily Twisted Board â€¢ GitHub Auto"
                      },
                      "timestamp": datetime.utcnow().isoformat()
                  }
              ]
          }

          requests.post(WEBHOOK_URL, json=payload)
          EOF